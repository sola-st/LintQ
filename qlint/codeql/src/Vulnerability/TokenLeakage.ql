/**
 * @name Token Leakage
 * @description Finds cases when the IBM token is leaked in the code.
 * @kind problem
 * @tags security
 *       qiskit
 * @problem.severity warning
 * @precision high
 * @id ql-token-leakage
 */

import python
import semmle.python.ApiGraphs
import qiskit.Circuit
import qiskit.SensitiveAPI

from
    DataFlow::Node token,
    IBMCloudTokenSink tokenSink
where
    token.asExpr().(StrConst).getText().regexpMatch("^[a-zA-Z0-9]{128}$")
    and
    token.(DataFlow::LocalSourceNode).flowsTo(tokenSink)
select
token, "IBMQ secret token leaked in the code."